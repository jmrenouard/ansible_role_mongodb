# Ansible Role: mongodb
# File: /defaults/main.yml
# Description: Managed by doc-sync workflow

---
mongodb_repo: true
mongodb_version: 6.0
mongodb_edition: org # org or enterprise
mongodb_pymongo_version: 4.7.2
mongodb_install_custom_playbook: "" # Path to custom playbook for alternative installation

# Apply production recommendations, see readme
mongodb_thp: true
mongodb_numa: true

mongodb_admin_pass: "change_me"
mongodb_adminuser_name: adminuser
mongodb_adminuser_pass: "change_me"

# --- Defaults for mongod.conf
# See readme

mongodb_net:
  bindIp: 0.0.0.0
  port: 27017

mongodb_systemlog:
  destination: file
  logAppend: true
  path: /var/log/mongodb/mongod.log

mongodb_storage:
  dbPath: /var/lib/mongo
  journal:
    enabled: true

# You should not change the pidfile location
mongodb_processmanagement:
  fork: true
  pidFilePath: /var/run/mongodb/mongod.pid
  timeZoneInfo: /usr/share/zoneinfo

# The keyfile is automatically generated
mongodb_security: ""

mongodb_operationprofiling: ""

mongodb_replication: ""

mongodb_sharding: ""
mongodb_sharding_role: "" # configsvr, shardsvr, mongos
mongodb_sharding_config_members: []
mongodb_sharding_shard_members: []
mongodb_sharding_shards: []

mongodb_auditlog: ""

mongodb_snmp: ""

# --- TLS/SSL Configuration
mongodb_tls_custom_playbook: "" # Path to custom playbook for alternative TLS certificate management
mongodb_tls_generate_certs: false
mongodb_tls_dir: /etc/ssl/mongodb
mongodb_tls_ca_cert: "{{ mongodb_tls_dir }}/mongodb-ca.crt"
mongodb_tls_ca_key: "{{ mongodb_tls_dir }}/mongodb-ca.key"
mongodb_tls_node_cert: "{{ mongodb_tls_dir }}/mongodb.pem" # Combined cert + key
mongodb_tls_node_key: "{{ mongodb_tls_dir }}/mongodb.key"

# CA Distinguished Name
mongodb_tls_ca_dn: "/C=FR/ST=Paris/L=Paris/O=MongoDB/CN=MongoDB-CA"
# Server Distinguished Name (Subject Alternative Names will be added automatically)
mongodb_tls_server_dn: "/C=FR/ST=Paris/L=Paris/O=MongoDB/CN={{ ansible_fqdn }}"

mongodb_custom_cnf: ""

# ---

# When replication is desired, the value should either be
# primary, secondary or aribter
# Ensure to include a valid number of nodes, see readme
mongodb_replication_role: ""

# Define databases and users
# See readme for examples
mongodb_user: []

# Backup via cronjob, executed with mongodump
# When there is replication, only active on one secondary
mongodb_backup:
  enabled: true
  dbs:
    - admin
    - config
    - local
  user: backup
  pass: change_me
  path: /var/lib/mongodb_backups
  owner: mongod
  group: mongod
  mode: "0660"
  hour: 2
  minute: 5
  day: "*"
  retention: 46 # in hours

# Restart mongo after a config change
mongodb_restart_config: true

# Amount of seconds before the next mongo instance will be restarted
mongodb_restart_seconds: 15
